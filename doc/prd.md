# 狼人杀LLM游戏控制台程序 PRD

## 1. 产品概述

### 1.1 产品简介
狼人杀LLM游戏控制台程序是一款基于Dart语言开发的文字游戏，通过大语言模型（LLM）扮演不同的游戏角色，让用户以上帝视角观察完整的狼人杀游戏过程。

### 1.2 产品目标
- 创建一个完整的狼人杀游戏体验
- 展示LLM在角色扮演和推理游戏中的应用
- 提供流畅的用户交互和游戏体验
- 实现自动化游戏流程管理

### 1.3 目标用户
- 狼人杀游戏爱好者
- 对LLM角色扮演感兴趣的用户
- 喜欢文字游戏的玩家

## 2. 游戏设计

### 2.1 基本配置
- **游戏人数**: 8-12人
- **角色配置**:
  - 狼人: 2-3人
  - 村民: 3-5人
  - 预言家: 1人
  - 女巫: 1人
  - 猎人: 1人
  - 守卫: 1人

### 2.2 游戏流程
1. **角色分配**: 随机分配角色给每个LLM玩家
2. **夜晚阶段**: 狼人杀人、特殊角色使用技能
3. **白天阶段**: 讨论和投票
4. **结束判定**: 游戏结束条件检查

### 2.3 胜利条件
- **好人胜利**: 所有狼人被淘汰
- **狼人胜利**: 狼人数量≥好人数量

## 3. 技术架构

### 3.1 技术栈
- **语言**: Dart 3.0+
- **平台**: 控制台应用程序
- **LLM集成**: OpenAI API 或其他LLM服务
- **状态管理**: Dart内置状态管理

### 3.2 核心模块
```
lib/
├── main.dart                 # 程序入口
├── game/
│   ├── game_engine.dart      # 游戏引擎
│   ├── game_state.dart       # 游戏状态管理
│   ├── role_system.dart      # 角色系统
│   └── phase_manager.dart    # 阶段管理器
├── player/
│   ├── player.dart           # 玩家基类
│   ├── ai_player.dart        # AI玩家
│   └── role.dart             # 角色定义
├── llm/
│   ├── llm_service.dart      # LLM服务接口
│   ├── prompt_manager.dart   # 提示词管理
│   └── response_parser.dart  # 响应解析
├── ui/
│   ├── console_ui.dart       # 控制台界面
│   ├── display_manager.dart  # 显示管理
│   └── input_handler.dart    # 输入处理
└── utils/
    ├── game_logger.dart      # 游戏日志
    ├── config_loader.dart    # 配置加载
    └── random_helper.dart    # 随机数助手
```

## 4. 功能规格

### 4.1 游戏初始化
- 玩家数量配置（8-12人）
- 角色分配算法
- 游戏规则设置
- LLM模型选择

### 4.2 角色系统
#### 4.2.1 基础角色
- **村民**: 无特殊技能，参与白天投票
- **狼人**: 夜晚可以杀死一名玩家

#### 4.2.2 神职角色
- **预言家**: 每晚查验一名玩家身份
- **女巫**:拥有一瓶解药和一瓶毒药
- **猎人**: 死亡时可以开枪带走一名玩家
- **守卫**: 每晚守护一名玩家

### 4.3 游戏阶段管理
#### 4.3.1 夜晚阶段
1. **狼人行动**: 狼人选择击杀目标
2. **守卫行动**: 守卫选择守护目标
3. **预言家行动**: 预言家查验身份
4. **女巫行动**: 女巫选择是否用药

#### 4.3.2 白天阶段
1. **夜晚信息公布**: 宣布死亡信息
2. **玩家讨论**: 玩家轮流发言讨论
3. **投票处决**: 玩家投票决定处决对象
4. **技能触发**: 处理死亡技能

### 4.4 LLM交互系统
#### 4.4.1 角色提示词
为每个角色定制专门的提示词，包含：
- 角色背景和性格
- 游戏目标和策略
- 交互规则和限制
- 语言风格指导

#### 4.4.2 上下文管理
- 维护每个角色的知识状态
- 管理游戏历史信息
- 处理角色间的信息传递

#### 4.4.3 响应解析
- 解析LLM的行动决策
- 提取角色的发言内容
- 处理模糊或无效响应

### 4.5 用户界面
#### 4.5.1 控制台显示
- 游戏状态面板
- 玩家信息展示
- 游戏日志输出
- 进度指示器

#### 4.5.2 用户交互
- 回合确认机制
- 游戏暂停/继续
- 速度控制
- 信息详细度调节

## 5. 详细设计

### 5.1 游戏状态设计
```dart
class GameState {
  List<Player> players;
  GamePhase currentPhase;
  int dayNumber;
  Map<String, dynamic> gameData;
  bool isGameOver;
  String? winner;
}
```

### 5.2 角色AI设计
#### 5.2.1 角色性格矩阵
每个角色具有以下性格维度：
- 激进度 vs 保守度
- 逻辑性 vs 直觉性
- 合作性 vs 独立性
- 诚实度 vs 欺骗度

#### 5.2.2 决策权重系统
- 基于角色的决策权重
- 动态策略调整
- 情绪影响因子

### 5.3 游戏平衡设计
#### 5.3.1 信息平衡
- 狼人知晓同伴身份
- 预言家获得查验信息
- 其他角色基于公开信息推理

#### 5.3.2 技能平衡
- 女巫药水限制
- 守卫守护规则
- 猎人技能触发条件

## 6. 实现计划

### 6.1 第一阶段：基础框架
- [ ] 创建项目结构和基础配置
- [ ] 实现游戏状态管理
- [ ] 开发控制台界面
- [ ] 基础工具类实现

### 6.2 第二阶段：核心逻辑
- [ ] 角色系统实现
- [ ] 游戏流程控制
- [ ] 基础游戏逻辑
- [ ] 胜负判定系统

### 6.3 第三阶段：LLM集成
- [ ] LLM服务接口
- [ ] 提示词系统
- [ ] 响应解析器
- [ ] 角色AI实现

### 6.4 第四阶段：游戏完善
- [ ] 游戏平衡调整
- [ ] 错误处理机制
- [ ] 用户体验优化
- [ ] 测试和调试

## 7. 风险评估

### 7.1 技术风险
- **LLM响应稳定性**: 可能需要多次重试或错误处理
- **游戏逻辑复杂性**: 需要仔细处理各种边界情况
- **性能问题**: LLM调用可能导致游戏进行缓慢

### 7.2 设计风险
- **游戏平衡性**: 角色配置可能需要反复调整
- **LLM角色真实性**: AI可能难以完美扮演特定角色
- **用户体验**: 控制台界面可能不够直观

### 7.3 缓解策略
- 实现重试机制和错误恢复
- 增加游戏配置的灵活性
- 提供详细的游戏日志和状态显示
- 设计用户友好的交互界面

## 8. 成功指标

### 8.1 功能完整性
- [ ] 所有基础角色正常工作
- [ ] 游戏流程完整无bug
- [ ] LLM角色扮演真实可信
- [ ] 用户界面操作流畅

### 8.2 用户体验
- [ ] 游戏进行速度合理（单局<30分钟）
- [ ] 角色行为符合预期
- [ ] 信息展示清晰易懂
- [ ] 交互过程自然顺畅

### 8.3 技术质量
- [ ] 代码结构清晰，模块化良好
- [ ] 错误处理完善
- [ ] 扩展性强，易于添加新角色
- [ ] 性能稳定，无明显延迟

## 9. 未来扩展

### 9.1 角色扩展
- 更多神职角色（如白痴、长老等）
- 第三方角色（如丘比特、盗贼等）
- 自定义角色系统

### 9.2 功能扩展
- 游戏回放功能
- 角色统计和胜率分析
- 多LLM模型支持
- 图形界面版本

### 9.3 社交功能
- 游戏直播集成
- 观众互动功能
- 游戏社区分享
- 模板和配置分享

---

## 附录

### A. 游戏术语表
- **LLM**: 大语言模型
- **God View**: 上帝视角，用户观察模式
- **Phase**: 游戏阶段（夜晚/白天）
- **Role Card**: 角色卡牌
- **Game State**: 游戏状态
- **AI Player**: AI控制的玩家

### B. 参考规则
- 基于标准狼人杀规则
- 参考"Mafia"游戏机制
- 适配LLM特性的规则调整

### C. 技术参考
- Dart官方文档
- OpenAI API文档
- 控制台UI设计最佳实践
- 游戏开发模式参考